<!DOCTYPE html>
<!-- Bu yazılım Dr. Zafer Akçalı tarafından oluşturulmuştur -->
<!-- Programmed by Zafer Akçalı, MD-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Display Authors Quartiles of Web of Science Publications</title>
    
<!-- https://github.com/mholt/PapaParse-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.0.0/papaparse.min.js"></script>	
<!-- // https://github.com/eligrey/FileSaver.js-->
<script src="https://cdn.jsdelivr.net/g/filesaver.js"></script> 

<script src="eissnq1.txt"></script>
<script src="eissnq2.txt"></script>
<script src="eissnq3.txt"></script>
<script src="eissnq4.txt"></script>
<script src="issnq1.txt"></script>
<script src="issnq2.txt"></script>
<script src="issnq3.txt"></script>
<script src="issnq4.txt"></script>
<script src="issnahci.txt"></script>
<script src="eissnahci.txt"></script>

<script src="namedict.txt"></script>
<script src="addresslist.txt"></script>
</head>
<body>
<label for="myfile">Select a csv file:</label>
<input type="file" id="csvfile" name="Csv File">
<button id="readBtn" onclick="readFunction()">Read</button> <br/> <br/>
Authors publications <br />
<textarea rows = "30" cols = "120" name = "Publications" id="publicationsArea"></textarea> <br /> 
<button id="convBtn" disabled onclick="convertFunction()">Convert</button> 	
<button id="copyBtn" disabled onclick="copyFunction()">Copy</button>
<button id="saveBtn" disabled onclick="saveFunction()">Save</button>
<br/>
Default delimiter:&nbsp;<input type="text" id="delimitValue" value=";" maxlength="1" size="1" onchange="changeDelimiter()"><br>
Include Q1 <input type="checkbox" id="q1Box" checked="true">
Q2 <input type="checkbox" id="q2Box" checked="true">
Q3 <input type="checkbox" id="q3Box" checked="true">
Q4 <input type="checkbox" id="q4Box" checked="true">
Q? <input type="checkbox" id="qxBox" checked="true"> 
AHCI <input type="checkbox" id="ahBox" checked="true"><br/> <br/>
Document Types  <br/>
Check ALL <input type="checkbox" id="allDocumentsBox" checked="true" onclick="selectAllDocuments()"> <br/> 
Include Article: <input type="checkbox" id="articleBox" checked="true">
Article-EA <input type="checkbox" id="articleEABox" checked="true">
Article-PP <input type="checkbox" id="articlePPBox" checked="true"> <br/>
Include Biographical: <input type="checkbox" id="biographicalBox" checked="true">	
Editorial Material <input type="checkbox" id="editorialBox" checked="true">  <br/>
Include  Letter: <input type="checkbox" id="letterBox" checked="true">
Letter-EA <input type="checkbox" id="letterEABox" checked="true"> <br/>
Include Meeting Abstract: <input type="checkbox" id="meetingBox" checked="true">
Proceedings Paper <input type="checkbox" id="proceedingsBox" checked="true"><br/>
Include Retraction: <input type="checkbox" id="retractionBox" checked="true">
Correction: <input type="checkbox" id="correctionBox" checked="true"> <br/>
Include Review: <input type="checkbox" id="reviewBox" checked="true">
Review-EA <input type="checkbox" id="reviewEABox" checked="true">
Book Review <input type="checkbox" id="bookReviewBox" checked="true">
<br/>
<script>
// global scope
var csvtext="";
var delimit=document.getElementById('delimitValue').value
const wosPrefix = 'https://gateway.webofknowledge.com/gateway/Gateway.cgi?GWVersion=2&SrcApp=Publons&SrcAuth=Publons_CEL&KeyUT='
const wosPostfix = '&DestLinkType=FullRecord&DestApp=WOS_CPL'
const doiPrefix = 'https://doi.org/'
const parseError = 'error parsing csv file, try to change delimiter: comma(,) versus semicolon(;)'
const eissnq1List = eissnq1.toString().split("\n"); // text to array
const eissnq2List = eissnq2.toString().split("\n");
const eissnq3List = eissnq3.toString().split("\n");
const eissnq4List = eissnq4.toString().split("\n");
const issnq1List = issnq1.toString().split("\n");
const issnq2List = issnq2.toString().split("\n");
const issnq3List = issnq3.toString().split("\n");
const issnq4List = issnq4.toString().split("\n");
const issnahList = issnah.toString().split("\n");
const eissnahList = eissnah.toString().split("\n");

function readFunction() {
document.getElementById('publicationsArea').value=""; // clear textarea
document.getElementById('copyBtn').disabled = true;  // disable copy button
document.getElementById('convBtn').disabled = true;  // disable convert button
document.getElementById('saveBtn').disabled = true;  // disable save button
document.getElementById('readBtn').disabled = true;  // disable read button
var file = document.getElementById('csvfile').files[0]; //get filename
var reader = new FileReader(); // html5 
	reader.onload = (function(file) {
	return function(e) {
	csvtext = this.result;	//read from csv file
		document.getElementById('publicationsArea').value=csvtext; // show in textarea
		document.getElementById('convBtn').disabled = false;  // enable convert button
		document.getElementById('readBtn').disabled = false;  // enable read button
           }
		})(file);
		reader.readAsText(file);
}
function convertFunction() {
var pubtext='NS'+delimit+'Author name'+delimit+'Author address'+delimit+'Quartile'+delimit+'Times cited'+delimit+'Article type'+delimit+'Authors'+delimit+'Aticle title'+delimit+'Article source'
+delimit+'Year'+delimit+'Volume-issue-page'+delimit+'WOS number'+delimit+'WOS link'+delimit+'Doi link\n';
var pubArray= new Array ([]); // an array, which contains publications
var authorArray = new Array ([]); // an array, which contains authors with their publication
var addresses="";
var department = "";
var nauthor = 0; // number of authors 
var quartile="";
document.getElementById('publicationsArea').value=""; // clear textarea
document.getElementById('copyBtn').disabled = true;  // disable copy button
document.getElementById('saveBtn').disabled = true;  // disable save button
document.getElementById('convBtn').disabled = true;  // disable convert button
	results = Papa.parse(csvtext, {	//parse from csv text
	header: true,
	delimiter: delimit,  // read from text box
	skipEmptyLines: true
});
nrows = results.data.length; // number of rows in csv file
// initialise every row of a multidimentional array
for (var i=0; i<nrows; i++) {
	pubArray.push([0]); // create rows of multidimentional array
	pubArray[i][0]="0"; // initialise first member of the row
 }
for (var i=0; i<nrows; i++) { // for each publication
	issn = results.data[i]['ISSN']
	eissn = results.data[i]['eISSN']
	if (issn=='') {issn ='NULL'} 
	if (eissn=='') {eissn ='NULL'} // danger!! empty eissn causes quartile to be Q1
	quartile = 'Q?'; // unknown, not in the list
	
	if (issnq1List.indexOf(issn) > -1 || eissnq1List.indexOf(eissn) > -1)
			{ quartile = 'Q1';}
	else if (issnq2List.indexOf(issn) > -1 || eissnq2List.indexOf(eissn) > -1)
			{ quartile = 'Q2';}
	else if (issnq3List.indexOf(issn) > -1 || eissnq3List.indexOf(eissn) > -1)
			{ quartile = 'Q3';}
	else if (issnq4List.indexOf(issn) > -1 || eissnq4List.indexOf(eissn) > -1)
			{ quartile = 'Q4';}
	else if (issnahList.indexOf(issn) > -1 || eissnahList.indexOf(eissn) > -1)
			{ quartile = 'AH';}
					
	if (document.getElementById('q1Box').checked == false && quartile == 'Q1') { continue; }
	if (document.getElementById('q2Box').checked == false && quartile == 'Q2') { continue; }
	if (document.getElementById('q3Box').checked == false && quartile == 'Q3') { continue; }
	if (document.getElementById('q4Box').checked == false && quartile == 'Q4') { continue; }
	if (document.getElementById('qxBox').checked == false && quartile == 'Q?') { continue; }	
	if (document.getElementById('ahBox').checked == false && quartile == 'AH') { continue; }		

	documentType=results.data[i]['Document Type']
	if (document.getElementById('articleBox').checked == false && documentType == 'Article') { continue; }
	if (document.getElementById('articleEABox').checked == false && documentType == 'Article; Early Access') { continue; }
	if (document.getElementById('articlePPBox').checked == false && documentType == 'Article; Proceedings Paper') { continue; }
	if (document.getElementById('biographicalBox').checked == false && documentType == 'Biographical-Item') { continue; }
	if (document.getElementById('editorialBox').checked == false && documentType == 'Editorial Material') { continue; }
	if (document.getElementById('letterBox').checked == false && documentType == 'Letter') { continue; }
	if (document.getElementById('letterEABox').checked == false && documentType == 'Letter; Early Access') { continue; }
	if (document.getElementById('meetingBox').checked == false && documentType == 'Meeting Abstract') { continue; }
	if (document.getElementById('proceedingsBox').checked == false && documentType == 'Proceedings Paper') { continue; }
	if (document.getElementById('retractionBox').checked == false && documentType == 'Retraction') { continue; }
	if (document.getElementById('correctionBox').checked == false && documentType == 'Correction') { continue; }
	if (document.getElementById('reviewBox').checked == false && documentType == 'Review') { continue; }	
	if (document.getElementById('reviewEABox').checked == false && documentType == 'Review; Early Access') { continue; }	
	if (document.getElementById('bookReviewBox').checked == false && documentType == 'Book Review') { continue; }

	weird = '' // assume each article in shape of normal address format and author format
	addresses = results.data[i].Addresses // deal with this text
	if (addresses === undefined ) {
	document.getElementById('publicationsArea').value = parseError;
	return;
	}
	if (addresses == '') { // if Addresses field if empty
		addresses = '[' + results.data[i]['Authors'] + '] ' +'Unkonown;'
		weird = '*'  // check output 
		}
	if (addresses.indexOf("[")==-1) { // if Addresses field doesn't contain names
		tempAuthor = results.data[i]['Authors'].replace(/;/g, '-') // regexp for all
		tempAddresses = addresses.replace(/;/g, '-') //regexp for all
		weird = '*'  // someting weird in Addresses column, check them by marking with (*)
		addresses = '['+tempAuthor+'] '+ tempAddresses
		}
	if (addresses.substring(0,1) != '[' ) {// if Addresses field doesn't start with [
		addresses ='[unknown] ' + addresses
		weird = '*' // someting weird in Addresses column, check them by marking with (*)
		}
	authors = addresses.slice(1).split("; [") //delete [, then go to first author of next address
	for (j=0;j<authors.length;j++) { // for each address
	department = authors[j].split ("] ") // department[0] contains authors, department[1] contains address
	author = department[0].split ("; ") // 
	let includeAddress=false;
	for (d=0; d<addressList.length;d++)
		if (department[1].includes(addressList[d])) { //department[1] contains current address 
			includeAddress = true; // current address is in the addresses list
			break;}
	if (includeAddress) 	{ // if Address is in the Addresses list
		for (k=0;k<author.length;k++) { // for each author
			authorArray.push ([0]); // create rows of multidimentional array
				for (var c=0; c<nameDict.length; c+=2) { // first item to last item
					if ( author[k]==nameDict[c]) {  // if author name is misspelled, then correct it
						author[k]=nameDict[c+1] 
						break; } // don't continue to search 
					}
			authorArray[nauthor][0]= author[k]; // name of author
			authorArray[nauthor][1]= department[1]; // address of author
			authorArray[nauthor][2] = quartile
			authorArray[nauthor][3] = results.data[i]['Times Cited, WoS Core']
			authorArray[nauthor][4] = results.data[i]['Document Type']
			authorArray[nauthor][5] = results.data[i]['Authors']
			authorArray[nauthor][6] = results.data[i]['Article Title']
			authorArray[nauthor][7] = results.data[i]['Source Title']
			pyear = results.data[i]['Publication Year']
				if (pyear == '') {
					accessdate = results.data[i]['Early Access Date'].split(' ') // seperate month and year
					pyear = accessdate[1] // second part of accessdate is year
					}
			authorArray[nauthor][8] = pyear
			authorArray[nauthor][9] = results.data[i]['Volume']
			issue = results.data[i]['Issue']
				if (issue != '') {
					issue = '('+issue+'):' // display (issue) if really exists
					}
					else if (results.data[i]['Volume'] != '') { // if volume exists, but issue is not
						issue = ':'
						}
			authorArray[nauthor][10] = issue
			authorArray[nauthor][11] = results.data[i]['Start Page']
			authorArray[nauthor][12] = results.data[i]['End Page']
			authorArray[nauthor][13] = results.data[i]['UT (Unique WOS ID)']
			authorArray[nauthor][14] = results.data[i]['DOI']
			doiLink = doiPrefix+results.data[i]['DOI']
			{ // add publication to text area
				pubtext = pubtext+weird
				+delimit+authorArray[nauthor][0] 
				+delimit+"\""+authorArray[nauthor][1]+"\"" // address of author, between " and "
				+delimit+ authorArray[nauthor][2] // quartile
				+delimit+ authorArray[nauthor][3] // times cited
				+delimit+"\""+authorArray[nauthor][4]+"\"" // Document type between " " not to confuse csv
				+delimit+"\""+authorArray[nauthor][5]+"\"" // Authors displayed between " and " not to confuse csv
				+delimit+"\""+authorArray[nauthor][6]+"\"" // Article title between " and "not to confuse csv
				+delimit+authorArray[nauthor][7] // source title
				+delimit+authorArray[nauthor][8] // publication year
				+delimit+"\""+authorArray[nauthor][9]+authorArray[nauthor][10]+authorArray[nauthor][11]+'-'+authorArray[nauthor][12]+"\"" // Volume, Issue, and page numbers displayed between " and "
				+delimit+authorArray[nauthor][13] //WOS
				+delimit+wosPrefix+authorArray[nauthor][13]+wosPostfix // WOS link
				+delimit+doiLink	//DOI link	
				+"\n"
				} // add publication to text area
			nauthor++;
			}
		} 
	}
}
document.getElementById('publicationsArea').value=pubtext;
document.getElementById('copyBtn').disabled = false; // enable copy button
document.getElementById('saveBtn').disabled = false;  // enable save button
document.getElementById('convBtn').disabled = true;  // disable convert button
}
function selectAllDocuments() {
var checkBox = document.getElementById('allDocumentsBox');
if (checkBox.checked == true) { 
	document.getElementById('articleBox').checked = true;
	document.getElementById('articleEABox').checked = true;
	document.getElementById('articlePPBox').checked = true;
	document.getElementById('biographicalBox').checked = true;
	document.getElementById('editorialBox').checked = true;
	document.getElementById('letterBox').checked = true;
	document.getElementById('letterEABox').checked = true;
	document.getElementById('meetingBox').checked = true;
	document.getElementById('proceedingsBox').checked = true;
	document.getElementById('retractionBox').checked = true;
	document.getElementById('correctionBox').checked = true;
	document.getElementById('reviewBox').checked = true;
	document.getElementById('reviewEABox').checked = true;
	document.getElementById('bookReviewBox').checked = true;
	}	
	else {	
	document.getElementById('articleBox').checked = false;
	document.getElementById('articleEABox').checked = false;
	document.getElementById('articlePPBox').checked = false;
	document.getElementById('biographicalBox').checked = false;
	document.getElementById('editorialBox').checked = false;
	document.getElementById('letterBox').checked = false;
	document.getElementById('letterEABox').checked = false;
	document.getElementById('meetingBox').checked = false;
	document.getElementById('proceedingsBox').checked = false;
	document.getElementById('retractionBox').checked = false;
	document.getElementById('correctionBox').checked = false;
	document.getElementById('reviewBox').checked = false;
	document.getElementById('reviewEABox').checked = false;
	document.getElementById('bookReviewBox').checked = false;
 	}
}
function changeDelimiter() {
	delimit=document.getElementById('delimitValue').value
}
function copyFunction() {
	document.getElementById('publicationsArea').select();
	document.execCommand("copy");
	document.getElementById('convBtn').disabled = false;  // enable convert button
}
function saveFunction() {
var blob = new Blob([document.getElementById('publicationsArea').value],
                { type: "text/plain;charset=utf-8" });
saveAs(blob, "output.csv");
	document.getElementById('convBtn').disabled = false;  // enable convert button
}
</script>
</body>
</html>